<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link type="application/atom+xml" rel="alternate" href="https://samwize.com/feed.xml" title="@samwize" />

  <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Guide to Universal Links | @samwize</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Guide to Universal Links" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Universal links are HTTP links that open your app, instead of the website in Safari." />
<meta property="og:description" content="Universal links are HTTP links that open your app, instead of the website in Safari." />
<link rel="canonical" href="https://samwize.com/2017/11/10/guide-to-universal-links/" />
<meta property="og:url" content="https://samwize.com/2017/11/10/guide-to-universal-links/" />
<meta property="og:site_name" content="@samwize" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-11-10T11:32:18+08:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@samwize" />
<meta name="twitter:creator" content="@samwize" />
<meta property="fb:admins" content="704185456" />
<script type="application/ld+json">
{"description":"Universal links are HTTP links that open your app, instead of the website in Safari.","headline":"Guide to Universal Links","dateModified":"2017-11-10T11:32:18+08:00","datePublished":"2017-11-10T11:32:18+08:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://samwize.com/2017/11/10/guide-to-universal-links/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://samwize.com/"}},"url":"https://samwize.com/2017/11/10/guide-to-universal-links/","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="icon" type="image/png" href="https://just2us.com/img/favicon-180.png" />
  <link rel="apple-touch-icon" href="https://just2us.com/img/favicon-192.png"/>

  <link rel="stylesheet" href="https://brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/css/print.css" />

</head>
  <link href='/stylesheets/all-5a7a81bc37ee3944f1d90d03edea2c57.css' media='all' rel='stylesheet' type='text/css'>
  <body itemscope itemtype="http://schema.org/Article">
    <a href="https://samwize.com" class="logo-readium"><span class="logo" style="background-image: url(/assets/icons/home.png)"></span></a>
    <main class="content" role="main">
      <article class="post">
        
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">Guide to Universal Links</h1>
            <div class="cf post-meta-text">
              <time datetime="2017-11-10T11:32:18+08:00">10 November 2017</time>
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          
          <p><a href="https://developer.apple.com/library/content/documentation/General/Conceptual/AppSearch/UniversalLinks.html">Universal links</a> are HTTP links that open your app, instead of the website in Safari.</p>

<p>The old way is called deeplink – where every app register it’s own schema eg. <code class="highlighter-rouge">myapp://</code></p>

<p>Universal links bring closer synergy between web and app with the familiar <code class="highlighter-rouge">https://</code></p>

<h2 id="step-1-apple-app-site-association-json-file">Step 1. apple-app-site-association JSON file</h2>

<p>This <strong>association file</strong> (AASA) is to establish the trust between your domain/server/website with your app.</p>

<p>Among the 3 steps, this step is the most complicated.</p>

<p>Let’s use an example of a <code class="highlighter-rouge">apple-app-site-association</code> file (note, there is no file extension):</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"applinks"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"apps"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
        </span><span class="nl">"details"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"appID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9JA89QQLNQ.com.apple.wwdc"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"paths"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"/wwdc/news/"</span><span class="p">,</span><span class="w"> </span><span class="s2">"NOT /videos/wwdc/2010/*"</span><span class="p">,</span><span class="w"> </span><span class="s2">"/videos/wwdc/201?/*"</span><span class="p">]</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"appID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ABCD1234.com.apple.messaging"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"paths"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"*"</span><span class="w"> </span><span class="p">]</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The <code class="highlighter-rouge">details</code> array is a list, with implicit priority in matching the paths.</p>

<p>You can support multiple apps as each detail has it’s own <code class="highlighter-rouge">appID</code>. The <code class="highlighter-rouge">appID</code> is made up of the team ID and the bundle ID.</p>

<p>The <code class="highlighter-rouge">paths</code> is a list of paths and:</p>

<ul>
  <li>You can exclude paths by using <code class="highlighter-rouge">NOT</code> prefix</li>
  <li>The system evaluate each path in order</li>
</ul>

<h2 id="step-15-optional-sign-it-or-not">Step 1.5 (Optional) Sign it or not</h2>

<p>If you only need universal link, this is optional.</p>

<p>But if you want to support <a href="https://developer.apple.com/documentation/security/shared_web_credentials">Shared Web Credentials</a> and Handsoff, then you must sign the AASA file.</p>

<h2 id="step-2-upload-to-server">Step 2. Upload to server</h2>

<p>You must make the AASA file crawlable by Apple bot, and can either place in:</p>

<ol>
  <li>https://mydomain.com/apple-app-site-association</li>
  <li>https://mydomain.com/.well-known/apple-app-site-association</li>
</ol>

<p>The following is important, yet it is not stated in the Apple’s guide (but you can find in the <a href="https://developer.apple.com/library/content/qa/qa1916/_index.html">troubleshooting FAQ</a>):</p>

<blockquote>
  <p>The AASA file must NOT be served through a 3xx redirect. Make sure this file is served without any redirects.</p>
</blockquote>

<p>And via HTTPS/SSL. And HTTP Content-type must be <code class="highlighter-rouge">application/json</code>.</p>

<p><del><a href="https://search.developer.apple.com/appsearch-validation-tool">Validate with Apple Bot</a>, and <strong>Link to Application</strong> should pass.</del> Apple’s tool is unreliable, so instead use <a href="http://branch.io/resources/aasa-validator/">Branch.io’s tool</a>,or <a href="https://limitless-sierra-4673.herokuapp.com">this heroku app</a>.</p>

<h2 id="step-3-add-entitlement-in-app">Step 3. Add entitlement in app</h2>

<p>Go to your target &gt; Capabilities &gt; Associated Domains, and include the domains that your app wants to handle.</p>

<p>You MUST prefix with <code class="highlighter-rouge">applinks:</code> eg. <code class="highlighter-rouge">applinks:mydomain.com</code></p>

<p>The system uses the longest substring matching.</p>

<p>When matched, it will trigger an NSUserActivity in your app delegate.</p>

<h2 id="step-4-handle-nsuseractivity">Step 4. Handle NSUserActivity</h2>

<p>Implement <a href="https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623072-application"><code class="highlighter-rouge">application:continueUserActivity:restorationHandler:</code></a> in your app delegate.</p>

<p>The same handler is used for Handsoff or Spotlight search. So how do you differentiate it is handling for tapping universal links? Look at <code class="highlighter-rouge">activityType</code> of <a href="https://developer.apple.com/documentation/foundation/nsuseractivity">NSUserActivity</a>.</p>

<p>Example:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="k">continue</span> <span class="nv">userActivity</span><span class="p">:</span> <span class="kt">NSUserActivity</span><span class="p">,</span> <span class="nv">restorationHandler</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="p">([</span><span class="kt">Any</span><span class="p">]?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">userActivity</span><span class="o">.</span><span class="n">activityType</span> <span class="o">==</span>  <span class="kt">NSUserActivityTypeBrowsingWeb</span> <span class="p">{</span>
            <span class="c1">// Handle universal link</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">userActivity</span><span class="o">.</span><span class="n">webpageURL</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span> <span class="p">}</span>
            <span class="c1">// Handle it..</span>
            <span class="k">return</span> <span class="kc">true</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">userActivity</span><span class="o">.</span><span class="n">activityType</span> <span class="o">==</span> <span class="kt">CSSearchableItemActionType</span> <span class="p">{</span>
            <span class="c1">// Handle spotlight search</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span>
</code></pre></div></div>

<h2 id="step-5-test-it">Step 5. Test it</h2>

<p>Your integration test flow:</p>

<ol>
  <li>Uninstall your app</li>
  <li>Install from Xcode (or TestFlight)</li>
  <li>Test a universal link in eg Email, Notes</li>
</ol>

<p>It seems like when you install your app during development, or beta from TestFlight, Apple bot will crawl the AASA file. That’s the trigger. That’s how you test universal links during development.</p>

<h2 id="when-will-it-open-app">When will it open app?</h2>

<p>If you reach here, then your app should be working with universal links.</p>

<p>But there are many pitfalls with universal links.</p>

<p>Sometimes, it doesn’t open as expected. Here is why it does NOT open your app:</p>

<ul>
  <li>In Safari, if user enter the domain in URL search bar</li>
  <li>In Safari, clicking on the same domain</li>
  <li>When your app is opened, but user tap on the top left breadcrumb that “Opens Safari”</li>
</ul>

<h2 id="more-on-the-breadcrumb">More on the breadcrumb</h2>

<p>iOS remembers the choice the user made when opening the universal link the first time.</p>

<p>Users could tap on the top left breadcrumb in status bar that says “Back to Safari”, and iOS will remember that the user does NOT want to open that in app!</p>

<p>Afterwhich, iOS continues to open your website in Safari until the user chooses to open your app <strong>by tapping OPEN in the Smart App Banner</strong> on the webpage. See these <a href="https://stackoverflow.com/a/39694208/242682">screenshots</a>.</p>

<h2 id="a-big-tip">A BIG Tip</h2>

<p>Another way is <strong>long pressing a link</strong>.</p>

<p>This will provide 2 options in a alert:</p>

<ol>
  <li>Open in Safari</li>
  <li>Open in “Your App”</li>
</ol>

<p>If you see (2), you know your universal link integration worked.</p>

<p>And now, whichever option the user chooses, iOS will remember it as The Choice.</p>

<h2 id="wkwebviewuiwebview">WKWebView/UIWebView</h2>

<p>We know universal links when tapped in Safari or Messages or etc will open the app (if possible).</p>

<p>What about in web views in other apps?</p>

<p>Quoting my previous <a href="http://samwize.com/2016/06/08/complete-guide-to-implementing-wkwebview/">guide in WKWebView</a>:</p>

<blockquote>
  <p>As noted in Apple Doc, iOS 9 users can tap on universal links in WKWebView, and it will open the app. It is the same for UIWebView and SFSafariViewController.</p>
</blockquote>

<p>However, recently there seems to be a <a href="https://stackoverflow.com/a/44942814/242682">hack</a> to NOT open the app. Use it to your advantage.</p>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>It could be frustrating to troubleshoot, so here is a list <a href="http://building.usebutton.com/debugging/ios/deep-linking/links/universal-links/2016/03/31/debugging-universal-links/">things to debug</a>, more on the <a href="https://sailthru.zendesk.com/hc/en-us/articles/217102466-Universal-Links-Troubleshooting-and-FAQ">paths in AASA</a>, the previously mentioned non-Apple <a href="https://limitless-sierra-4673.herokuapp.com">AASA validation tool</a>, and good to know that it seems like the AASA file is fetched on the device everytime the app is <a href="https://stackoverflow.com/a/35616335/242682">installed/updated</a>, and then cached.</p>

<p>If still didn’t work, at least know there are others who <a href="https://medium.com/mobile-growth/the-things-i-hate-and-you-should-know-about-apple-universal-links-5beb15f88a29">hate</a> it too.</p>

<p>Try restarting your device too. It did happen to me once during development where it just won’t fetch from any of the applinks domain, until I restart my phone.</p>

        </section>
        <footer class="post-footer">
          <section class="share">
            
              
            
              
            
          </section>
        </footer>
        <div class="bottom-teaser cf">
          <hr>
          <!-- Adsense-->
          <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
          <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-8504591086876220"
             data-ad-slot="5237367904"
             data-ad-format="auto"></ins>
          <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
        </div>
        
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'just2us'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        
      </article>
    </main>
    <div class="bottom-closer">
      <div class="background-closer-image"  style="background-image: url(/assets/profile/big-sur.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">@samwize</h1>
        <h2 class="blog-description">¯\_(ツ)_/¯
</h2>
        <a href="/" class="btn">Back to Home</a>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/assets/js/index.js"></script>
<script type="text/javascript" src="/assets/js/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');

      $window.on('scroll', function() {
        var top = $window.scrollTop();

        if (top < 0 || top > 1500) { return; }
        $image
          .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
          .css('opacity', 1-Math.max(top/700, 0));
      });
      $window.trigger('scroll');

      var height = $('.article-image').height();
      $('.post-content').css('padding-top', height + 'px');

      $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
         && location.hostname == this.hostname) {
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
          if (target.length) {
            $('html,body').animate({ scrollTop: target.offset().top }, 500);
            return false;
          }
        }
      });

  });
}(jQuery));
</script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-8780506-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-8504591086876220",
          enable_page_level_ads: true
     });
</script>
  </body>
</html>
