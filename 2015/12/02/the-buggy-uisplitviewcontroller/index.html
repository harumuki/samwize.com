<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <!-- (1) Optimize for mobile versions: http://goo.gl/EOpFl -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- (1) force latest IE rendering engine: bit.ly/1c8EiC9 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>The Buggy UISplitViewController</title>
  <meta name="description" content="When iOS 8 was released, UISplitViewController has a big upgrade -- it is no longer restricted to only iPad. That means, you can use the same on iPhone, therefore building a truly universal app." />

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@samwize" />
    <meta name="twitter:title" content="The Buggy UISplitViewController" />
    <meta name="twitter:image" content="http://samwize.com" />
    
    <meta name="twitter:description"  content="When iOS 8 was released, UISplitViewController has a big upgrade -- it is no longer restricted to only iPad. That means, you can use the same on iPhone, therefore building a truly universal app." />
    
  
  
  <meta property="og:site_name" content="@samwize" />
  <meta property="og:title" content="The Buggy UISplitViewController"/>
  
  <meta property="og:description" content="When iOS 8 was released, UISplitViewController has a big upgrade -- it is no longer restricted to only iPad. That means, you can use the same on iPhone, therefore building a truly universal app." />
  
  <meta property="og:image" content="http://samwize.com" />
  <meta property="og:url" content="http://samwize.com/2015/12/02/the-buggy-uisplitviewcontroller/" >
  <meta property="og:type" content="blog" />
  <meta property="article:published_time" content="2015-12-02T18:18:54+08:00">

  <link rel="canonical" href="http://samwize.com/2015/12/02/the-buggy-uisplitviewcontroller/">

  <link rel="shortcut icon" href="/assets/images/favicon.ico">
  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/css/print.css" />
</head>
  <link href='/stylesheets/all-0419ecbe5c65e8f9dc66e3c2afb220bf.css' media='all' rel='stylesheet' type='text/css'>
  <body itemscope itemtype="http://schema.org/Article">
    <!-- header start -->

<a href="http://samwize.com" class="logo-readium"><span class="logo" style="background-image: url(/assets/icons/home.png)"></span></a>

<!-- header end -->
    <main class="content" role="main">
      <article class="post">
        
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">The Buggy UISplitViewController</h1>
            <div class="cf post-meta-text">
              <time datetime="2015-12-02T18:18:54+08:00">02 December 2015</time>
              <!-- , tagged on <span class="post-tag-">, <a href="/tag/"></a></span> -->
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          
          <p>When iOS 8 was released, <code>UISplitViewController</code> has a big upgrade -- it is no longer restricted to only iPad. That means, you can use the same on iPhone, therefore building a truly universal app.</p>

<p>NSHipster has a <a href="https://www.google.com/search?client=safari&amp;rls=en&amp;q=uisplitviewcontroller+bug&amp;ie=UTF-8&amp;oe=UTF-8">good guide</a> to <code>UISplitViewController</code>.</p>

<p>Here, I only want to point out the horrible bugs.</p>

<h2>My Typical Setup</h2>

<p><img src="/images/uisplitviewcontroller-setup.png"  ></p>

<p>My storyboard consists of:</p>

<ol>
<li>a master/primary view in a <code>UINavigationViewController</code></li>
<li>a detail/secondary view in a <code>UINavigationViewController</code></li>
<li>both have a <code>UITextField</code> pinned to the bottom</li>
</ol>

<p>Not much code needed to demo the bugs. It&#39;s all in the master <code>ViewController</code> as such:</p>

<figure class='code-highlight-figure'><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="k">class</span> <span class="nl">ViewController</span><span class="p">:</span> <span class="bp">UIViewController</span><span class="p">,</span> <span class="bp">UISplitViewControllerDelegate</span> <span class="p">&#x7b;</span>
</div></div><div data-line='2' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='3' class='code-highlight-row numbered'><div class='code-highlight-line'>    <span class="kr">override</span> <span class="k">func</span> <span class="n">viewDidLoad</span><span class="p">()</span> <span class="p">&#x7b;</span>
</div></div><div data-line='4' class='code-highlight-row numbered'><div class='code-highlight-line'>        <span class="nb">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>
</div></div><div data-line='5' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='6' class='code-highlight-row numbered'><div class='code-highlight-line'>        <span class="n">splitViewController</span><span class="o">?</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span>
</div></div><div data-line='7' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='8' class='code-highlight-row numbered'><div class='code-highlight-line'>        <span class="c1">// Display mode can be: AllVisible | PrimaryOverlay | etc</span>
</div></div><div data-line='9' class='code-highlight-row numbered'><div class='code-highlight-line'>        <span class="c1">// Set to .PrimaryOverlay, and the bugs will come</span>
</div></div><div data-line='10' class='code-highlight-row numbered'><div class='code-highlight-line'>        <span class="nb">self</span><span class="p">.</span><span class="n">splitViewController</span><span class="o">?</span><span class="p">.</span><span class="n">preferredDisplayMode</span> <span class="o">=</span> <span class="p">.</span><span class="n">PrimaryOverlay</span>
</div></div><div data-line='11' class='code-highlight-row numbered'><div class='code-highlight-line'>    <span class="p">&#x7d;</span>
</div></div><div data-line='12' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='13' class='code-highlight-row numbered'><div class='code-highlight-line'>    <span class="k">func</span> <span class="n">splitViewController</span><span class="p">(</span><span class="nl">splitViewController</span><span class="p">:</span> <span class="bp">UISplitViewController</span><span class="p">,</span> <span class="n">collapseSecondaryViewController</span> <span class="nl">secondaryViewController</span><span class="p">:</span> <span class="bp">UIViewController</span><span class="p">,</span> <span class="n">ontoPrimaryViewController</span> <span class="nl">primaryViewController</span><span class="p">:</span> <span class="bp">UIViewController</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Bool</span> <span class="p">&#x7b;</span>
</div></div><div data-line='14' class='code-highlight-row numbered'><div class='code-highlight-line'>        <span class="c1">// To show detail first for eg iPhone compact size</span>
</div></div><div data-line='15' class='code-highlight-row numbered'><div class='code-highlight-line'>        <span class="k">return</span> <span class="nb">false</span>
</div></div><div data-line='16' class='code-highlight-row numbered'><div class='code-highlight-line'>    <span class="p">&#x7d;</span>
</div></div><div data-line='17' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">&#x7d;</span></div></div></pre></div></figure>

<p>I tested in simulator and real devices, running the latest iOS 9.1.</p>

<h2>The BUGS</h2>

<p>When <code>preferredDisplayMode</code> is set to <code>PrimaryOverlay</code> (or <code>PrimaryHidden</code> or <code>Automatic</code>), 2 bugs will be introduced:</p>

<ol>
<li>In iPad, swipe from left edge on detail will not show master!</li>
<li>The controller view will auto adjust whenever keyboard is shown</li>
</ol>

<p><iframe width="640" height="480" src="https://www.youtube.com/embed/vYGw9BCdyC4?rel=0" frameborder="0" allowfullscreen></iframe><br/></p>

<p>In fact, only by setting to <code>AllVisible</code> then things work correctly.</p>

<p>Bug #1 - Not being able to swipe from left edge is irritating, but luckily you can still have <code>displayModeButtonItem</code> that can be added to your navigation bar.</p>

<p>Bug #2 - auto adjusting your view is much more irritating. It looks like a <em>feature</em> at first, because it will prevent keyboard from blocking your <code>UITextField</code>.</p>

<p>However, the behaviour is buggy in iPhone. By switching to landscape, then back to portrait (as shown in the video above), the view will not auto adjust now! Because of that, you can&#39;t safely assume your view will be adjusted correctly. Neither can you add codes to prevent the keyboard from blocking other views.</p>

<p>What&#39;s more, the animation is laggy..</p>

<p>Terribe. Terrible.</p>

<h2>Bonus Bug</h2>

<p>Actually, there could be a warning <code>Unbalanced calls to begin/end appearance transitions</code> if you simply set <code>preferredDisplayMode</code>.</p>

<p>You have to wrap it around a dispatch block..</p>

<figure class='code-highlight-figure'><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">// Why set the display mode in dispatch?</span>
</div></div><div data-line='2' class='code-highlight-row numbered'><div class='code-highlight-line'>        <span class="c1">// It&#39;s a workaround: http://stackoverflow.com/a/28440974/242682</span>
</div></div><div data-line='3' class='code-highlight-row numbered'><div class='code-highlight-line'>        <span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">())</span> <span class="p">&#x7b;</span>
</div></div><div data-line='4' class='code-highlight-row numbered'><div class='code-highlight-line'>            <span class="c1">// Display mode can be: AllVisible | PrimaryOverlay | etc</span>
</div></div><div data-line='5' class='code-highlight-row numbered'><div class='code-highlight-line'>            <span class="c1">// The bugs coming from the mode .PrimaryOverlay</span>
</div></div><div data-line='6' class='code-highlight-row numbered'><div class='code-highlight-line'>            <span class="nb">self</span><span class="p">.</span><span class="n">splitViewController</span><span class="o">?</span><span class="p">.</span><span class="n">preferredDisplayMode</span> <span class="o">=</span> <span class="p">.</span><span class="n">PrimaryOverlay</span>
</div></div><div data-line='7' class='code-highlight-row numbered'><div class='code-highlight-line'>        <span class="p">&#x7d;</span></div></div></pre></div></figure>

<p>It&#39;s a warning, but show how buggy <code>UISplitViewController</code> is!</p>

<h2>UPDATE</h2>

<p>After conversing with an Apple engineer, here is what I knew.</p>

<p><code>preferredDisplayMode</code> is merely <em>your preferred mode</em>. The actual mode depends on the device size class, as <a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UISplitViewController_class/#//apple_ref/occ/instp/UISplitViewController/preferredDisplayMode">stated in doc</a>.</p>

<blockquote>
<p>Use this property to specify the display mode that you prefer to use. The split view controller makes every effort to adopt the interface you specify but may use a different type of interface if there is not enough space to support your preferred choice. If changing the value of this property leads to an actual change in the current display mode, the split view controller animates the resulting change.</p>

<p>Setting the value of this property to <code>UISplitViewControllerDisplayModeAutomatic</code> causes the split view controller to choose the most appropriate display mode for the currently available space. On iPad, this results in use of the mode <code>UISplitViewControllerDisplayModePrimaryOverlay</code> in portrait orientations and <code>UISplitViewControllerDisplayModeAllVisible</code> in landscape orientations. The default value of this property is <code>UISplitViewControllerDisplayModeAutomatic</code>.</p>
</blockquote>

<p>When you rotate to landscape (regular horizontally), the mode will change to <code>AllVisible</code> automatically. And even after you rotate to portrait, it will remain <code>AllVisible</code>!</p>

<p>Hence, if you want it to be always <code>PrimaryOverlay</code>, then you have to set <code>preferredDisplayMode</code> every time there is a rotation:</p>

<figure class='code-highlight-figure'><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="kr">override</span> <span class="k">func</span> <span class="nf">willAnimateRotationToInterfaceOrientation</span><span class="p">(</span><span class="nl">toInterfaceOrientation</span><span class="p">:</span> <span class="n">UIInterfaceOrientation</span><span class="p">,</span> <span class="nl">duration</span><span class="p">:</span> <span class="n">NSTimeInterval</span><span class="p">)</span> <span class="p">&#x7b;</span>
</div></div><div data-line='2' class='code-highlight-row numbered'><div class='code-highlight-line'>        <span class="nb">self</span><span class="p">.</span><span class="n">splitViewController</span><span class="o">?</span><span class="p">.</span><span class="n">preferredDisplayMode</span> <span class="o">=</span> <span class="p">.</span><span class="n">PrimaryOverlay</span>
</div></div><div data-line='3' class='code-highlight-row numbered'><div class='code-highlight-line'>    <span class="p">&#x7d;</span></div></div></pre></div></figure>

<p>Okay, got that.</p>

<p>Now the last mystery is why would <code>PrimaryOverlay</code> cause the view to adjust when keyboard is shown?</p>

<p>This is because in <code>PrimaryOverlay</code>, the master view is presented within a <strong>popover</strong>, and popovers will automatically adjust in response to keyboard..</p>

        </section>
        <footer class="post-footer">
          <section class="share">
            
              
                <a class="icon-twitter" href="http://twitter.com/share?text=The+Buggy+UISplitViewController&amp;url=http://samwize.com/2015/12/02/the-buggy-uisplitviewcontroller"
                  onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
                <i class="fa fa-twitter"></i><span class="hidden">twitter</span>
                </a>
              
            
              
                <a class="icon-facebook" href="https://www.facebook.com/sharer.php?t=The+Buggy+UISplitViewController&amp;u=http://samwize.com/2015/12/02/the-buggy-uisplitviewcontroller"
                  onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
                <i class="fa fa-facebook"></i><span class="hidden">facebook</span>
                </a>
              
            
              
            
              
                <a class="icon-google-plus" href="https://plus.google.com/share?t=The+Buggy+UISplitViewController&amp;url=http://samwize.com/2015/12/02/the-buggy-uisplitviewcontroller"
                  onclick="window.open(this.href, 'google-plus-share', 'width=550,height=255');return false;">
                <i class="fa fa-google-plus"></i><span class="hidden">google-plus</span>
                </a>
              
            
          </section>
        </footer>
        <div class="bottom-teaser cf">
          <hr>
          <!-- Adsense-->
          <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
          <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-8504591086876220"
             data-ad-slot="5237367904"
             data-ad-format="auto"></ins>
          <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
        </div>
        
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'just2us'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        
      </article>
    </main>
    <div class="bottom-closer">
      <div class="background-closer-image"  style="background-image: url(/assets/profile/cover-2015.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">@samwize</h1>
        <h2 class="blog-description">¯\_(ツ)_/¯
</h2>
        <a href="/" class="btn">Back to Home</a>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/assets/js/index.js"></script>
<script type="text/javascript" src="/assets/js/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    
      $window.on('scroll', function() {
        var top = $window.scrollTop();

        if (top < 0 || top > 1500) { return; }
        $image
          .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
          .css('opacity', 1-Math.max(top/700, 0));
      });
      $window.trigger('scroll');

      var height = $('.article-image').height();
      $('.post-content').css('padding-top', height + 'px');

      $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
         && location.hostname == this.hostname) {
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
          if (target.length) {
            $('html,body').animate({ scrollTop: target.offset().top }, 500);
            return false;
          }
        }
      });

  });
}(jQuery));
</script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-8780506-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  </body>
</html>
