<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>@samwize</title>
    <description>¯\_(ツ)_/¯
</description>
    <link>http://samwize.com/</link>
    <atom:link href="http://samwize.com/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Thu, 28 Sep 2017 15:00:02 +0800</pubDate>
    <lastBuildDate>Thu, 28 Sep 2017 15:00:02 +0800</lastBuildDate>
    <generator>Jekyll v3.1.6</generator>
    
      <item>
        <title>Guide to Using Codable Struct for JSON</title>
        <description>&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Codable&lt;/code&gt; is a new feature introduced along with Swfit 4 for encoding and decoding models easily, making third party libraries such as SwiftyJSON and Unbox obsolete. It is part of Foundation framework, and is a must know if you use JSON format.&lt;/p&gt;

&lt;h2 id=&quot;the-basic&quot;&gt;The Basic&lt;/h2&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Codable&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;numberOfLegs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Add &lt;code class=&quot;highlighter-rouge&quot;&gt;Codable&lt;/code&gt; as a trait to your type, and that’s it.&lt;/p&gt;

&lt;p&gt;You enjoy &lt;strong&gt;automatic encoding and decoding&lt;/strong&gt;, thanks to default extension for the &lt;code class=&quot;highlighter-rouge&quot;&gt;Codable&lt;/code&gt; protocol.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;numberOfLegs&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;It works automatically as long as the members are &lt;code class=&quot;highlighter-rouge&quot;&gt;Codable&lt;/code&gt; type. Later section will explain what to do if your type cannot conform to &lt;code class=&quot;highlighter-rouge&quot;&gt;Codable&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Codable&lt;/code&gt; is actually made up of 2 protocols – &lt;code class=&quot;highlighter-rouge&quot;&gt;Encodable&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Decodable&lt;/code&gt; – and you can use one if you don’t need the other. In this post, we will highlight for both encoding and decoding, but feel free to decouple them.&lt;/p&gt;

&lt;h2 id=&quot;encoding-to-json-string&quot;&gt;Encoding to JSON string&lt;/h2&gt;

&lt;p&gt;With a &lt;code class=&quot;highlighter-rouge&quot;&gt;Codable&lt;/code&gt; type you can encode to JSON string easily.&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;numberOfLegs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;encoder&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;JSONEncoder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;encoder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;outputFormatting&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prettyPrinted&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try!&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;utf8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;You probably will omit the pretty print in production code.&lt;/p&gt;

&lt;h2 id=&quot;decoding-from-json-string&quot;&gt;Decoding from JSON string&lt;/h2&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;decoder&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;JSONDecoder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;jsonData&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;jsonString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;using&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;utf8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;animal&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try!&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decoder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Animal&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;jsonData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;what-about-plist&quot;&gt;What about plist?&lt;/h2&gt;

&lt;p&gt;This post is about JSON, but it is trivial to encode/decode other formats.&lt;/p&gt;

&lt;p&gt;Simply change &lt;code class=&quot;highlighter-rouge&quot;&gt;JSONEncoder&lt;/code&gt;/&lt;code class=&quot;highlighter-rouge&quot;&gt;JSONDecoder&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;PropertyListEncoder&lt;/code&gt;/&lt;code class=&quot;highlighter-rouge&quot;&gt;PropertyListDecoder&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&quot;when-you-need-a-different-key-name&quot;&gt;When you need a different key name&lt;/h2&gt;

&lt;p&gt;Let’s say for the JSON, you want the key name to be “number_of_legs” (snake cased), instead of “numberOfLegs”.&lt;/p&gt;

&lt;p&gt;To customize the JSON key names, add &lt;code class=&quot;highlighter-rouge&quot;&gt;CodingKeys&lt;/code&gt; enum to the struct.&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Codable&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;numberOfLegs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;CodingKeys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;CodingKey&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numberOfLegs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;number_of_legs&quot;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Now, there is some magic performed by the compiler with the &lt;code class=&quot;highlighter-rouge&quot;&gt;CodingKeys&lt;/code&gt; enum. The compiler only recognize the enum name “CodingKeys”, reserved as the keys for the struct.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Note: &lt;code class=&quot;highlighter-rouge&quot;&gt;CodingKeys&lt;/code&gt; is a compiler recognized enum, while &lt;code class=&quot;highlighter-rouge&quot;&gt;CodingKey&lt;/code&gt; is the protocol.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;You may in fact have your own type that implements the &lt;code class=&quot;highlighter-rouge&quot;&gt;CodingKey&lt;/code&gt; protocol. Read on.&lt;/p&gt;

&lt;h2 id=&quot;when-you-need-a-nested-structure&quot;&gt;When you need a nested structure&lt;/h2&gt;

&lt;p&gt;When your struct is flat, but maps to a nested structure in the JSON, you have more work to do.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;anatomy&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&quot;numberOfLegs&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Firstly, you have to add your keys for the nested. We add &lt;code class=&quot;highlighter-rouge&quot;&gt;AnatomyCodingKeys&lt;/code&gt; which implements &lt;code class=&quot;highlighter-rouge&quot;&gt;CodingKey&lt;/code&gt; protocol.&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Animal&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;numberOfLegs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt;
    
    &lt;span class=&quot;kd&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;CodingKeys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;CodingKey&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;anatomy&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;kd&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;AnatomyCodingKeys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;CodingKey&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;numberOfLegs&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Then you implement &lt;code class=&quot;highlighter-rouge&quot;&gt;Encodable&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Decodable&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;extension&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Encodable&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;encoder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Encoder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// #1&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;container&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;container&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;keyedBy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;CodingKeys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// #2 and #3&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;anatomyContainer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;container&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;nestedContainer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;keyedBy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;AnatomyCodingKeys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;forKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;anatomy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// #4&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;anatomyContainer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;numberOfLegs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;forKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;numberOfLegs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The encoding process is as such:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Get the main container with keys as per &lt;code class=&quot;highlighter-rouge&quot;&gt;CodingKeys&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Get the nested container, which is in the main container at the key “anatomy” (of &lt;code class=&quot;highlighter-rouge&quot;&gt;CodingKeys&lt;/code&gt;)&lt;/li&gt;
  &lt;li&gt;Main container has keys as per &lt;code class=&quot;highlighter-rouge&quot;&gt;AnatomyCodingKeys&lt;/code&gt; (aka “keyed by”)&lt;/li&gt;
  &lt;li&gt;Encode each type with key&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The decoding is similar.&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;extension&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Animal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Decodable&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;decoder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Decoder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;container&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;decoder&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;container&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;keyedBy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;CodingKeys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;anatomyContainer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;container&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;nestedContainer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;keyedBy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;AnatomyCodingKeys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;forKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;anatomy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;numberOfLegs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;anatomyContainer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;forKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;numberOfLegs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;error-with-a-dictionary-member&quot;&gt;Error with a Dictionary member&lt;/h2&gt;

&lt;p&gt;Let’s look at an unexpected scenario, a struct having a Dictionary as it’s member.&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Sword&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Codable&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Dictionary&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Codable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;Sword&lt;/code&gt; has a flexible member &lt;code class=&quot;highlighter-rouge&quot;&gt;properties&lt;/code&gt;, which basically can store any key-value pair. But there will be a compile error.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Type &#39;Sword&#39; does not conform to protocol &#39;Encodable&#39;
Type &#39;Sword&#39; does not conform to protocol &#39;Decodable&#39;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The problem is because a &lt;code class=&quot;highlighter-rouge&quot;&gt;Dictionary&lt;/code&gt; is not a Codable, even thought the values in it is.&lt;/p&gt;

&lt;p&gt;It such case, you will need dynamic coding keys, an advanced topic.&lt;/p&gt;

&lt;h2 id=&quot;dynamic-coding-keys&quot;&gt;Dynamic Coding Keys&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://developer.apple.com/documentation/foundation/archives_and_serialization/using_json_with_custom_types&quot;&gt;Apple codable playground&lt;/a&gt; provides a sample code on how you can have a dynamic key eg. the keys are not defined exhausively in the &lt;code class=&quot;highlighter-rouge&quot;&gt;CodingKeys&lt;/code&gt; enum.&lt;/p&gt;

&lt;p&gt;In our scenario, that’s what we want for the Dictionary, where the keys in it can be any string.&lt;/p&gt;

&lt;p&gt;Create &lt;code class=&quot;highlighter-rouge&quot;&gt;DynamicKey&lt;/code&gt;, which implements &lt;code class=&quot;highlighter-rouge&quot;&gt;CodingKey&lt;/code&gt;, but it only can be init with a string.&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;DynamicKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;CodingKey&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;stringValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;stringValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stringValue&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stringValue&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;intValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;intValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Then we extend &lt;code class=&quot;highlighter-rouge&quot;&gt;KeyedEncodingContainer&lt;/code&gt; to provide the method to encode the dictionary.&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;extension&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;KeyedEncodingContainer&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Key&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;DynamicKey&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;    
    &lt;span class=&quot;k&quot;&gt;mutating&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;encodeDynamicKeyValues&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;withDictionary&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Any&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dictionary&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;dynamicKey&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;DynamicKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;stringValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;forKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dynamicKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;forKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dynamicKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Type &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;of&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt; not supported&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The above &lt;code class=&quot;highlighter-rouge&quot;&gt;encodeDynamicKeyValues&lt;/code&gt; has a shortfall: you need to add to the types supported. The above code illustrated only for String and Int. &lt;em&gt;If you know of a better approach, let me know!&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;To use, in &lt;code class=&quot;highlighter-rouge&quot;&gt;encode(to:)&lt;/code&gt;,&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;propertiesContainer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;container&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;nestedContainer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;keyedBy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;DynamicKey&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;forKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;properties&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;propertiesContainer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;encodeDynamicKeyValues&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;withDictionary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;I will leave the implementation of &lt;code class=&quot;highlighter-rouge&quot;&gt;KeyedDecodingContainer&lt;/code&gt; as an exercise :)&lt;/p&gt;

&lt;p&gt;Or check &lt;a href=&quot;https://gist.github.com/samwize/a82f29a1fb34091cd61fc06934568f82&quot;&gt;my gist&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;what-is-a-container&quot;&gt;What is a container?&lt;/h2&gt;

&lt;p&gt;If you need to customize the encoding and decoding, you will need to grasp the concept of containers.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/2017/08/03/wwdc-2017-whats-new-in-foundation/&quot;&gt;&lt;img src=&quot;/images/wwdc-foundation-codable.png&quot; alt=&quot;&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;A container is one of 3 types:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Keyed Container – provides values by keys, like a dictionary&lt;/li&gt;
  &lt;li&gt;Unkeyed Container – provides ordered values without keys, like an array&lt;/li&gt;
  &lt;li&gt;Single Value Container – a single raw value&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;In encoding/decoding, you need to use the correct type of container as per the JSON/whatever structure you have.&lt;/p&gt;

&lt;h2 id=&quot;resources&quot;&gt;Resources&lt;/h2&gt;

&lt;p&gt;Codable is &lt;a href=&quot;https://github.com/apple/swift/blob/master/stdlib/public/core/Codable.swift&quot;&gt;open source&lt;/a&gt;, so we can dig it and understand how it works internally.&lt;/p&gt;

&lt;p&gt;A more useful resource provided by Apple is the &lt;a href=&quot;https://developer.apple.com/documentation/foundation/archives_and_serialization/using_json_with_custom_types&quot;&gt;playground for custom type&lt;/a&gt;, showing how we could achieve dynamic coding keys.&lt;/p&gt;

&lt;p&gt;Apple has a &lt;a href=&quot;https://developer.apple.com/documentation/foundation/archives_and_serialization/encoding_and_decoding_custom_types&quot;&gt;basic guide&lt;/a&gt;. Other good guides include &lt;a href=&quot;http://swiftjson.guide&quot;&gt;swiftjson.guide&lt;/a&gt; and &lt;a href=&quot;https://www.raywenderlich.com/172145/encoding-decoding-and-serialization-in-swift-4&quot;&gt;raywenderlich’s&lt;/a&gt;&lt;/p&gt;
</description>
        <pubDate>Tue, 26 Sep 2017 12:30:24 +0800</pubDate>
        <link>http://samwize.com/2017/09/26/guide-to-using-codable-struct-for-json-the-new-thing-in-swift-4/</link>
        <guid isPermaLink="true">http://samwize.com/2017/09/26/guide-to-using-codable-struct-for-json-the-new-thing-in-swift-4/</guid>
        
        
        <category>Swift</category>
        
      </item>
    
      <item>
        <title>Migrating to Swift 4 and @objc</title>
        <description>&lt;p&gt;Swift’s official &lt;a href=&quot;https://swift.org/migration-guide-swift4/&quot;&gt;migration guide&lt;/a&gt; gives a good overview.&lt;/p&gt;

&lt;p&gt;Using the migration assistant in the new Xcode 9 would have helped to rename most of the SDK changes, such as moving string contants to enum cases.&lt;/p&gt;

&lt;p&gt;This post will highlight the other trickly cases.&lt;/p&gt;

&lt;h2 id=&quot;distinguish-single-tuple-from-multiple-argument-function-types-se-0110&quot;&gt;Distinguish single-tuple from multiple-argument function types [SE-0110]&lt;/h2&gt;

&lt;p&gt;There is an issue with Swift 3 in distinguishing between the type of the argument in a closure.&lt;/p&gt;

&lt;p&gt;Is it a tuple with 2 arguments?&lt;/p&gt;

&lt;p&gt;Or is it 2 arguments?&lt;/p&gt;

&lt;p&gt;Proposal &lt;a href=&quot;https://github.com/apple/swift-evolution/blob/master/proposals/0110-distingish-single-tuple-arg.md&quot;&gt;SE-0110&lt;/a&gt; seeks to correct that.&lt;/p&gt;

&lt;p&gt;In short, to declare a function type with 1 tuple, you will need to double enclose with brackets:&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Int&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Xcode will also suggest rewriting &lt;code class=&quot;highlighter-rouge&quot;&gt;f: (Void) -&amp;gt; ()&lt;/code&gt; to &lt;code class=&quot;highlighter-rouge&quot;&gt;f: () -&amp;gt; ()&lt;/code&gt;, because your probably just mean that.&lt;/p&gt;

&lt;h2 id=&quot;objc-has-to-be-explicit-se-0160&quot;&gt;@objc has to be explicit [SE-0160]&lt;/h2&gt;

&lt;p&gt;The biggest change is to do with Objective-C inference.&lt;/p&gt;

&lt;p&gt;The details is in the proposal &lt;a href=&quot;https://github.com/apple/swift-evolution/blob/master/proposals/0160-objc-inference.md&quot;&gt;SE-0160&lt;/a&gt; (it’s long).&lt;/p&gt;

&lt;p&gt;The change is not only source breaking, but worse, could introduce bugs unknowingly. This is because you could still build and run, but if some of your type/method is no longer available to Objective-C runtime (because @objc is no longer inferred anymore), the method will just fail to respond.&lt;/p&gt;

&lt;p&gt;That’s why this change is big, and you should test all parts of your user flow.&lt;/p&gt;

&lt;h4 id=&quot;the-switch-in-project-settings&quot;&gt;The switch in project settings&lt;/h4&gt;

&lt;p&gt;After migrating to Swift 4, &lt;strong&gt;Swift 3 @objc Inference&lt;/strong&gt; remains &lt;strong&gt;On&lt;/strong&gt;, for good reason because as we said, this change is breaking.&lt;/p&gt;

&lt;p&gt;There is benefits to switching it to off – that is not to infer @objc for all types. Things will be faster, binary smaller.&lt;/p&gt;

&lt;p&gt;When you switch to &lt;strong&gt;Off&lt;/strong&gt; (default), make sure your app still works well. You could unknowingly introduce bugs (likely not crash) because some functions are no longer inferred to be available to Objective-C runtime.&lt;/p&gt;

&lt;h4 id=&quot;when-it-doesnt-work&quot;&gt;When it doesn’t work..&lt;/h4&gt;

&lt;p&gt;To fix, you can add 2 annotations to tell the compiler it is to be available for Objective-C runtime.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;@objc&lt;/code&gt; can be added to a function.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;@objcMembers&lt;/code&gt; can  be added to a type, and all members and functions will be infered, unless, of course, if the function uses pure Swift features eg. tuple.&lt;/p&gt;

&lt;h4 id=&quot;extensions-cannot-override-yet&quot;&gt;Extensions cannot override yet&lt;/h4&gt;

&lt;p&gt;Another common error as a result is to do with extension methods that are overriden.&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;extension&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Super&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Remember, without @objc, this is not available to objc &lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Sub&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;Super&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The above code will have error “declarations in extensions cannot override yet”.&lt;/p&gt;

&lt;p&gt;The fix is to add @objc to the function in the extension.&lt;/p&gt;

&lt;h4 id=&quot;summary-of-code-impact&quot;&gt;Summary of code impact&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;Subclass of &lt;code class=&quot;highlighter-rouge&quot;&gt;NSObject&lt;/code&gt; no NOT infer as @objc&lt;/li&gt;
  &lt;li&gt;Run your tests&lt;/li&gt;
  &lt;li&gt;Check all app flow to make sure they are working, if not add &lt;code class=&quot;highlighter-rouge&quot;&gt;@objc&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;@objcMembers&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Add @objc to extension functions that needs to be overriden&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;dynamic&lt;/code&gt; must have @objc – this is easy to fix because compiler will have error&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Wed, 20 Sep 2017 16:37:53 +0800</pubDate>
        <link>http://samwize.com/2017/09/20/migrating-to-swift-4-and-xcode-9/</link>
        <guid isPermaLink="true">http://samwize.com/2017/09/20/migrating-to-swift-4-and-xcode-9/</guid>
        
        
        <category>Swift</category>
        
        <category>Xcode</category>
        
      </item>
    
      <item>
        <title>How to Change iOS App Icon Programmatically (iOS 10.3)</title>
        <description>&lt;p&gt;Changing the app icon is just &lt;a href=&quot;https://developer.apple.com/documentation/uikit/uiapplication/2806818-setalternateiconname&quot;&gt;1 line of code&lt;/a&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;setAlternateIconName&lt;/code&gt;, but there are many pitfalls, and the lack of guide on how to do it.&lt;/p&gt;

&lt;h2 id=&quot;the-code&quot;&gt;The Code&lt;/h2&gt;

&lt;p&gt;Let’s start with the easy part, which is the code to change the app icon programmatically.&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;#available(iOS 10.3, *)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;newAppIconName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;AppIcon-2&quot;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;guard&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;UIApplication&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shared&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alternateIconName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;newAppIconName&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kt&quot;&gt;UIApplication&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shared&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;setAlternateIconName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;newAppIconName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;You might thought you can put the code in app delegate when the app is launched, but no, that will have this un-helpful error:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Error Domain=NSCocoaErrorDomain Code=3072 “The operation was cancelled.”&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;pitfall-code-must-be-called-in-view-controller&quot;&gt;Pitfall: Code must be called in view controller&lt;/h2&gt;

&lt;p&gt;You must call &lt;code class=&quot;highlighter-rouge&quot;&gt;setAlternateIconName&lt;/code&gt; only in view controller, and in main thread.&lt;/p&gt;

&lt;p&gt;Why?&lt;/p&gt;

&lt;p&gt;Because the user will be shown this alert:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/appicon-change-alert.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;If you want to run the code in app delegate, make sure it is run in main queue, and visible in the main window.&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;pitfall-you-cannot-avoid-the-system-alert&quot;&gt;Pitfall: You cannot avoid the system alert&lt;/h2&gt;

&lt;p&gt;The alert and the text “You have changed the icon for …” cannot be changed, nor removed.&lt;/p&gt;

&lt;p&gt;In &lt;a href=&quot;https://developer.apple.com/ios/human-interface-guidelines/graphics/app-icon/&quot;&gt;Apple Human Interface Guildeline (HIG)&lt;/a&gt;, they did mention that changing the app icon is a user triggered action.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;You can perform tricks to dismiss the alert, or cover with another screen, but that is against the HIG.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;This is also why in the code there is a &lt;code class=&quot;highlighter-rouge&quot;&gt;guard&lt;/code&gt; statement. It prevents setting the icon name again, and therefore triggering the alert, if it already is that icon.&lt;/p&gt;

&lt;h2 id=&quot;the-infoplist&quot;&gt;The Info.plist&lt;/h2&gt;

&lt;p&gt;Now that you understand the code and how it works, let’s setup the app’s Info.plist.&lt;/p&gt;

&lt;p&gt;The following has to be added:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&quot;language-plist&quot;&gt;&amp;lt;key&amp;gt;CFBundleIcons&amp;lt;/key&amp;gt;
&amp;lt;dict&amp;gt;
  &amp;lt;key&amp;gt;CFBundlePrimaryIcon&amp;lt;/key&amp;gt;
  &amp;lt;dict&amp;gt;
    &amp;lt;key&amp;gt;CFBundleIconFiles&amp;lt;/key&amp;gt;
    &amp;lt;array&amp;gt;
      &amp;lt;string&amp;gt;AppIcon&amp;lt;/string&amp;gt;
    &amp;lt;/array&amp;gt;
    &amp;lt;key&amp;gt;UIPrerenderedIcon&amp;lt;/key&amp;gt;
    &amp;lt;true/&amp;gt;
  &amp;lt;/dict&amp;gt;
  &amp;lt;key&amp;gt;CFBundleAlternateIcons&amp;lt;/key&amp;gt;
  &amp;lt;dict&amp;gt;
    &amp;lt;key&amp;gt;AppIcon-2&amp;lt;/key&amp;gt;
    &amp;lt;dict&amp;gt;
      &amp;lt;key&amp;gt;CFBundleIconFiles&amp;lt;/key&amp;gt;
      &amp;lt;array&amp;gt;
        &amp;lt;string&amp;gt;AppIcon-2&amp;lt;/string&amp;gt;
      &amp;lt;/array&amp;gt;
      &amp;lt;key&amp;gt;UIPrerenderedIcon&amp;lt;/key&amp;gt;
      &amp;lt;true/&amp;gt;
    &amp;lt;/dict&amp;gt;
  &amp;lt;/dict&amp;gt;
&amp;lt;/dict&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The &lt;a href=&quot;https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CoreFoundationKeys.html#//apple_ref/doc/uid/TP40009249-SW13&quot;&gt;keys are explained&lt;/a&gt;, but in short:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;CFBundleIcons&lt;/code&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;CFBundlePrimaryIcon&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;CFBundleAlternateIcons&lt;/code&gt; - dictionary of alternative icons, with the key name as the name that you will use in code eg. “AppIcon-2”&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;You may wonder what why “AppIcon-2” is repeated in &lt;code class=&quot;highlighter-rouge&quot;&gt;CFBundleIconFiles&lt;/code&gt;?&lt;/p&gt;

&lt;p&gt;That is actually the image file name (less the “png” or “@2x”). It need not be necessary the same as the key in &lt;code class=&quot;highlighter-rouge&quot;&gt;CFBundleAlternateIcons&lt;/code&gt;. For simplicity we used the same name.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Important&lt;/strong&gt;: If you need to support for iPad, read the last section on a critical pitfall.&lt;/p&gt;

&lt;h2 id=&quot;pitfall-cannot-use-asset-catalog&quot;&gt;Pitfall: Cannot use asset catalog&lt;/h2&gt;

&lt;p&gt;Strangely, alternative icons CANNOT be added to your asset catalog, unlike the primary icon.&lt;/p&gt;

&lt;p&gt;If you do that, you will see an un-helpful error again.&lt;/p&gt;

&lt;p&gt;You have to add “AppIcon-2.png”, “AppIcon-2@2x.png”, “AppIcon-2@3x.png” (180x180) to your app target.&lt;/p&gt;

&lt;h2 id=&quot;pitfall-you-need-completionhandler&quot;&gt;Pitfall: You need &lt;code class=&quot;highlighter-rouge&quot;&gt;completionHandler&lt;/code&gt;&lt;/h2&gt;

&lt;p&gt;Although &lt;code class=&quot;highlighter-rouge&quot;&gt;setAlternateIconName&lt;/code&gt; can accept a nil &lt;code class=&quot;highlighter-rouge&quot;&gt;completionHandler&lt;/code&gt;, as declared in its signature, you shouldn’t because the app with CRASH, if somehow there is error.&lt;/p&gt;

&lt;p&gt;As &lt;a href=&quot;https://forums.developer.apple.com/thread/71463&quot;&gt;dlbuckley&lt;/a&gt; pointed out (as of Aug 2017),&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;This API isn’t quite ready to be released to us thugs&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;pitfall-not-working-or-crash-in-ipad&quot;&gt;Pitfall: Not working or Crash in iPad&lt;/h2&gt;

&lt;p&gt;This is another common one, and critical, because for the neglected iPad.&lt;/p&gt;

&lt;p&gt;You could run into error like this:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Error Domain=NSCocoaErrorDomain Code=4 &quot;The file doesn’t exist.&quot; 
UserInfo={NSUnderlyingError=0x60000005e0c0 {Error Domain=LSApplicationWorkspaceErrorDomain 
Code=-105 &quot;iconName not found in CFBundleAlternateIcons entry&quot; 
UserInfo={NSLocalizedDescription=iconName not found in CFBundleAlternateIcons entry}}}
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;In Apple’s &lt;a href=&quot;https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CoreFoundationKeys.html#//apple_ref/doc/uid/TP40009249-SW14&quot;&gt;obscure documentation&lt;/a&gt;, it pointed out:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Important: If your app contains iPad-specific versions of its icons, the system does not fall back to the alternate icons declared in the platform-agnostic version of CFBundleIcons key. Therefore, if you include any alternate icons in the CFBundleIcons key, you must include them again in your CFBundleIcons~ipad variant.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;That means, in your “Info.plist”, you need to have a separate entry with &lt;code class=&quot;highlighter-rouge&quot;&gt;CFBundleIcons~ipad&lt;/code&gt; key!&lt;/p&gt;

&lt;p&gt;So, copy whatever in &lt;code class=&quot;highlighter-rouge&quot;&gt;CFBundleIcons&lt;/code&gt; and add for &lt;code class=&quot;highlighter-rouge&quot;&gt;CFBundleIcons~ipad&lt;/code&gt;.&lt;/p&gt;
</description>
        <pubDate>Sun, 20 Aug 2017 16:09:07 +0800</pubDate>
        <link>http://samwize.com/2017/08/20/how-to-change-ios-app-icon-programmatically-ios-10-3/</link>
        <guid isPermaLink="true">http://samwize.com/2017/08/20/how-to-change-ios-app-icon-programmatically-ios-10-3/</guid>
        
        
        <category>iOS</category>
        
      </item>
    
      <item>
        <title>How Oracle screwed me for 2 months with an UNDERSCORE</title>
        <description>&lt;p&gt;&lt;em&gt;tldr; I was integrating Oracle’s mobile push SDK and was stuck for 2 months. Turned out they have an embarassing bug involving an underscore! Oracle’s Responsys/PushIO proved right – enterprise product sucks.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;This post is my rant on how bad Oracle’s product is.&lt;/p&gt;

&lt;h2 id=&quot;the-ridiculous-bug&quot;&gt;The ridiculous bug&lt;/h2&gt;

&lt;p&gt;I spent 2 months to figure out why our iOS app did not display rich message pushed from Oracle’s platform. It boils down to an UNDERSCORE.&lt;/p&gt;

&lt;p&gt;Yes, freaking &lt;code class=&quot;highlighter-rouge&quot;&gt;_&lt;/code&gt;, generated in their API key is the reason why our app didn’t work.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/pushio-ridiculous-bug.jpg&quot; alt=&quot;&quot; class=&quot;border&quot; /&gt;&lt;/p&gt;

&lt;p&gt;From Oracle’s developer support:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The bug is that your API key was generated with an underscore “_” and that is an invalid character for how the API key is used downstream.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;The fix should be pretty straighforward… create a new platform until you get one without underscores in the API key.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Wow.&lt;/p&gt;

&lt;p&gt;It is an embarassing bug, but what appal me more is how they deal with it.&lt;/p&gt;

&lt;h2 id=&quot;a-major-bug&quot;&gt;A major bug&lt;/h2&gt;

&lt;p&gt;Firstly, the bug affects majority of their users, since I took 3 tries, before getting a “valid” one.&lt;/p&gt;

&lt;p&gt;I estimate &lt;strong&gt;66% of users&lt;/strong&gt; could have generated “invalid” keys.&lt;/p&gt;

&lt;p&gt;The bug has big impact. All rich push messages will NOT be displayed in the app!&lt;/p&gt;

&lt;h2 id=&quot;not-fixing-their-sdk-quickly&quot;&gt;Not fixing their SDK quickly&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/pushio/PushIOManager_iOS/tags&quot;&gt;PushIO last release&lt;/a&gt; of their SDK is 16 Jun 2017, that is 2 months ago as of writing.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;I give them the benefit of doubt, as I assume the bug only appear in that release, though I do believe the bug happens way before version 6.32.1.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The point is, a major bug should be fixed quickly. But Oracle did not.&lt;/p&gt;

&lt;p&gt;Not to mention this should be an easy fix. They could fix their API key generator, probably in a few lines of code. Somehow Oracle choose not to.&lt;/p&gt;

&lt;h2 id=&quot;lack-of-knowledge-on-the-issue&quot;&gt;Lack of knowledge on the issue&lt;/h2&gt;

&lt;p&gt;Our account manager and a couple of customer support officers did not know about the embarassing &lt;code class=&quot;highlighter-rouge&quot;&gt;_&lt;/code&gt; issue, until it escalated to their developer.&lt;/p&gt;

&lt;p&gt;It could mean:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;They don’t have many users and this issue never came up&lt;/li&gt;
  &lt;li&gt;They have a problem with communicating and sharing of such knowledge&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Either way, as a user, I am less confident with Oracle.&lt;/p&gt;

&lt;h2 id=&quot;we-took-2-long-months&quot;&gt;We took 2 long months&lt;/h2&gt;

&lt;p&gt;Why so long?&lt;/p&gt;

&lt;p&gt;While trying to investigate the issue and isolate the problem, I asked a simple quesion: &lt;em&gt;&lt;strong&gt;Is there an iOS sample code?&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Replies from “enterprise support” ain’t lightning fast.&lt;/p&gt;

&lt;p&gt;It took 2 weeks, before they finally have an answer – no, they don’t. Again, it reveals a lack of knowledgebase to such FAQ.&lt;/p&gt;

&lt;p&gt;Investigating why our push failed is tedious and slow, because I have to &lt;strong&gt;wait till the next day&lt;/strong&gt; to check the logs from an &lt;strong&gt;FTP server&lt;/strong&gt;. It feels so 1990s.&lt;/p&gt;

&lt;h2 id=&quot;a-problem-with-the-enterprise-suite-of-products&quot;&gt;A problem with the enterprise suite of products&lt;/h2&gt;

&lt;p&gt;Responsys is an enterprise email marketing tool – a slow and complicated web app. &lt;a href=&quot;https://mailchimp.com&quot;&gt;Mail Chimp&lt;/a&gt; on the other hand, a rival, is cool and user friendly.&lt;/p&gt;

&lt;p&gt;PushIO is a mobile push SDK, in a very crowded space since 2009, when Apple revolutionized push. It’s better rivals include &lt;a href=&quot;https://www.urbanairship.com&quot;&gt;Urban Airship&lt;/a&gt; and &lt;a href=&quot;https://onesignal.com/&quot;&gt;OneSignal&lt;/a&gt; (free!).&lt;/p&gt;

&lt;p&gt;In 2014, Oracle &lt;em&gt;eat&lt;/em&gt; Responsys, who in turn &lt;em&gt;eat&lt;/em&gt; PushIO – a in &lt;a href=&quot;https://www.bizjournals.com/denver/blog/boosters_bits/2014/01/repsonsys-buys-push-io-before-being.html&quot;&gt;&lt;strong&gt;$1.5 billion acquisition&lt;/strong&gt;&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;When a large corporation acquires a team and it’s product, it is the &lt;strong&gt;start of a downfall&lt;/strong&gt;. This case is messier since a fat clumpsy fish eat a fish which eat another small fish.&lt;/p&gt;

&lt;p&gt;The small fish (PushIO) probably died tragically.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/pushio-big-fish-eat-little-fish.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;
</description>
        <pubDate>Sun, 06 Aug 2017 00:25:18 +0800</pubDate>
        <link>http://samwize.com/2017/08/06/how-oracle-screwed-me-with-an-underscore/</link>
        <guid isPermaLink="true">http://samwize.com/2017/08/06/how-oracle-screwed-me-with-an-underscore/</guid>
        
        
        <category>Rant</category>
        
        <category>API</category>
        
      </item>
    
      <item>
        <title>WWDC 2017 - What&#39;s New in Foundation</title>
        <description>&lt;p&gt;Summary of what’s new in Foundation, Swift 4, from &lt;a href=&quot;https://developer.apple.com/videos/play/wwdc2017/212/&quot;&gt;session 212&lt;/a&gt;. &lt;em&gt;Tip: You can download WWDC videos easily with &lt;a href=&quot;https://github.com/samwize/wwdc-dl&quot;&gt;wwdc-dl&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;

&lt;h2 id=&quot;key-paths&quot;&gt;Key Paths&lt;/h2&gt;

&lt;p&gt;Apple calls it Smart, because it is statically safe, and fast.&lt;/p&gt;

&lt;p&gt;It is built into Swift language, with a single &lt;code class=&quot;highlighter-rouge&quot;&gt;\&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/wwdc-foundation-keypath.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// To get via keypath&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;age&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ben&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;keyPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Kid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// To set via keypaht&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ben&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;keyPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;Kid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nickname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Ben&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;appending-key-paths&quot;&gt;Appending Key Paths&lt;/h2&gt;

&lt;p&gt;You can append key path, provided the type you “chain” is the same.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/wwdc-foundation-keypath-appending.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So if you append, the final keypath is simply of type &lt;code class=&quot;highlighter-rouge&quot;&gt;Keypath&amp;lt;BirthdayParty, Double&amp;gt;&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;There are more keypath types.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/wwdc-foundation-keypath-more.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;key-value-observation&quot;&gt;Key-Value Observation&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/images/wwdc-foundation-keypath-kvo.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// To use&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;observation&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mia&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;observe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;observed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;change&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// observed is the updated &quot;mia&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;codablejson&quot;&gt;Codable/JSON&lt;/h2&gt;

&lt;p&gt;Swift also finally recognize the importance of JSON.&lt;/p&gt;

&lt;p&gt;You simply add the trait protocol &lt;code class=&quot;highlighter-rouge&quot;&gt;Codable&lt;/code&gt; to your model, and it will work (because of &lt;a href=&quot;http://samwize.com/2016/10/24/swift-protocol-development-guide/&quot;&gt;default protocol extension&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/wwdc-foundation-codable.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If you want to customize the key names, you can simply add your own &lt;code class=&quot;highlighter-rouge&quot;&gt;CodingKeys&lt;/code&gt; as an enum in your model. See how the camel case “comment_count” is customized:&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;CodingKeys&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;CodingKey&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;author&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;commentCount&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;comment_count&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Ok, actually &lt;code class=&quot;highlighter-rouge&quot;&gt;Codable&lt;/code&gt; is not only for JSON data, but for &lt;a href=&quot;https://developer.apple.com/documentation/foundation/archives_and_serialization&quot;&gt;other formats&lt;/a&gt; like Property List too. There is &lt;code class=&quot;highlighter-rouge&quot;&gt;JSONDecoder&lt;/code&gt;, and also &lt;code class=&quot;highlighter-rouge&quot;&gt;PropertyListDecoder&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;what-else-&quot;&gt;What Else ?&lt;/h2&gt;

&lt;p&gt;There is &lt;a href=&quot;https://www.raywenderlich.com/163857/whats-new-swift-4&quot;&gt;more&lt;/a&gt; in Swift 4, some small, some advanced API. Many were not touched in session 212.&lt;/p&gt;

&lt;p&gt;Not going to cover all, but here are some teasers:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;String is now a Collection&lt;/li&gt;
  &lt;li&gt;Multi-line string with &lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;&quot;&quot;&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Collection has more API such as &lt;code class=&quot;highlighter-rouge&quot;&gt;mapValues&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;MutableCollection.swapAt(_:_:)&lt;/code&gt;, default Dictionary value&lt;/li&gt;
  &lt;li&gt;Infer one-sided range eg. infer start and end index&lt;/li&gt;
  &lt;li&gt;Generic subscript&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;fileprivate&lt;/code&gt; &lt;a href=&quot;/2017/04/20/access-levels-in-swift/&quot;&gt;access level&lt;/a&gt; for extension across files&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/2017/09/20/migrating-to-swift-4-and-xcode-9/&quot;&gt;No more&lt;/a&gt; @objc inference&lt;/li&gt;
&lt;/ul&gt;
</description>
        <pubDate>Thu, 03 Aug 2017 16:17:08 +0800</pubDate>
        <link>http://samwize.com/2017/08/03/wwdc-2017-whats-new-in-foundation/</link>
        <guid isPermaLink="true">http://samwize.com/2017/08/03/wwdc-2017-whats-new-in-foundation/</guid>
        
        
        <category>Swift</category>
        
      </item>
    
      <item>
        <title>How to Use Git Bisect to Find the First Bad Commit</title>
        <description>&lt;p&gt;Git has a very powerful command for developers to &lt;strong&gt;systematically find the commit&lt;/strong&gt; that introduce a bug.&lt;/p&gt;

&lt;p&gt;You mark commits as &lt;code class=&quot;highlighter-rouge&quot;&gt;good&lt;/code&gt; OR &lt;code class=&quot;highlighter-rouge&quot;&gt;bad&lt;/code&gt;, and using divide-and-conquer strategy, you will find the first bad commit in a few pass (even with hundreds of commits).&lt;/p&gt;

&lt;h2 id=&quot;steps&quot;&gt;Steps&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# 1. Mark current branch that has the bug
git bisect bad

# 2. Mark a tag that is working, or use a commit SHA directly
git bisect good v1.2.3

# 3. Git will automatically checkout the commit between the good and bad
#    You will have to identify if that commit is good or bad, and mark with 
git bisect bad
# OR
git bisect good
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Eventually, you will find the first bad commit.&lt;/p&gt;

&lt;p&gt;You can return to your previous branch with &lt;code class=&quot;highlighter-rouge&quot;&gt;git bisect reset&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;For more features, refer to &lt;a href=&quot;https://git-scm.com/docs/git-bisect/&quot;&gt;git-scm doc&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;what-if-you-are-looking-for-the-first-change&quot;&gt;What if you are looking for the first change?&lt;/h2&gt;

&lt;p&gt;Sometimes, you are not finding the first commit that is &lt;strong&gt;bad&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Rather, you want to find the first commit that has &lt;strong&gt;new changes&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Since Git v2.7.0, they introduced &lt;code class=&quot;highlighter-rouge&quot;&gt;new&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;bad&lt;/code&gt; as new terms. If you want to use your own terms, or if you are using older version of git, you can define your terms.&lt;/p&gt;

&lt;p&gt;Example to have  &lt;code class=&quot;highlighter-rouge&quot;&gt;fixed&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;unfixed&lt;/code&gt;,&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git bisect start --term-new=fixed --term-old=unfixed
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;Then mark with,&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;git bisect fixed
git bisect unfixed
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;h2 id=&quot;what-is-the-very-first-commit-sha&quot;&gt;What is the very first commit SHA?&lt;/h2&gt;

&lt;p&gt;The “Initial Commit” SHA can be retrieved with:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;git rev-list --max-parents=0 HEAD&lt;/code&gt;&lt;/p&gt;
</description>
        <pubDate>Thu, 27 Jul 2017 10:47:55 +0800</pubDate>
        <link>http://samwize.com/2017/07/27/how-to-use-git-bisect-to-find-the-first-bad-commit/</link>
        <guid isPermaLink="true">http://samwize.com/2017/07/27/how-to-use-git-bisect-to-find-the-first-bad-commit/</guid>
        
        
        <category>Git</category>
        
      </item>
    
      <item>
        <title>What Steve Jobs Thinks of React Native</title>
        <description>&lt;p&gt;Adobe announced they are &lt;a href=&quot;https://www.theverge.com/2017/7/25/16026236/adobe-flash-end-of-support-2020&quot;&gt;killing Flash&lt;/a&gt; in 2020.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.apple.com/hotnews/thoughts-on-flash/&quot;&gt;7 years ago&lt;/a&gt;, Steve Jobs explained why Apple and iPhone doesn’t support Flash.&lt;/p&gt;

&lt;p&gt;He was right.&lt;/p&gt;

&lt;h2 id=&quot;the-most-important-reason&quot;&gt;The most important reason&lt;/h2&gt;

&lt;p&gt;The sixth reason, the most important, he said:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;We know from painful experience that letting a third party layer of software come between the platform and the developer ultimately results in sub-standard apps and hinders the enhancement and progress of the platform.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;If developers grow dependent on third party development libraries and tools, they can only take advantage of platform enhancements if and when the third party chooses to adopt the new features.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;We cannot be at the mercy of a third party deciding if and when they will make our enhancements available to our developers.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;This becomes even worse if the third party is supplying a cross platform development tool.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Flash was a cross platform development tool.&lt;/p&gt;

&lt;p&gt;React Native is a cross platform development tool, too.&lt;/p&gt;

&lt;p&gt;I &lt;a href=&quot;http://samwize.com/2017/01/24/why-i-hate-react-native/&quot;&gt;hate React Native&lt;/a&gt;, and I briefly mentioned the &lt;a href=&quot;http://samwize.com/2017/01/09/react-native-for-ios-swift-developer/&quot;&gt;disadvantage of using another big dependency&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;These past events have once again reminded us to “bet” on good technologies, and who to trust.&lt;/p&gt;
</description>
        <pubDate>Wed, 26 Jul 2017 13:32:02 +0800</pubDate>
        <link>http://samwize.com/2017/07/26/what-steve-jobs-thinks-of-react-native/</link>
        <guid isPermaLink="true">http://samwize.com/2017/07/26/what-steve-jobs-thinks-of-react-native/</guid>
        
        
        <category>React Native</category>
        
      </item>
    
      <item>
        <title>Backing Up Photos Library and Handling Corrupted Files Error -36</title>
        <description>&lt;p&gt;I was backing up my Photos Library, a huge 500 GB &lt;code class=&quot;highlighter-rouge&quot;&gt;Photos Library.photoslibrary&lt;/code&gt;, and copying the file to my external drive, it had this error:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The Finder can’t complete the operation because some data in Photos Library.photoslibrary” can’t be read or written. (Error code -36)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;As ambiguous as it can be, error code 36 turns out to be I/O problem, or corrupted files.&lt;/p&gt;

&lt;p&gt;For my case, it is most likely a corrupted photo/video. I have no idea how they became corrupted in Photos. Either Photos app is buggy and corrupted it, or my harddrive is faulty..&lt;/p&gt;

&lt;p&gt;In any case, I have to recover them.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.macworld.com/article/3189985/photography/how-to-fix-an-uncopyable-iphoto-or-photos-library.html&quot;&gt;MacWorld has a tip&lt;/a&gt; on creating a new “photoslibrary”, revealing the package, and manually copying the original files to the new directory. Doing so will reveal the exact files that are throwing the error.&lt;/p&gt;

&lt;p&gt;But if you have lots of photos/videos and there are lots of corrupted files, then you will save lots of time if you know how to use the command line.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ditto -v ~/Pictures/Photos&lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt;Library.photoslibrary/ /Volumes/MyDrive/Photos&lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt;Library.photoslibrary/
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;ditto&lt;/code&gt; command will copy without stopping on failure. Instead, it will log the files with problem.&lt;/p&gt;

&lt;h2 id=&quot;copying-corrupted-files&quot;&gt;Copying Corrupted Files&lt;/h2&gt;

&lt;p&gt;The above will skip the corrupted files. Not a big deal if you can afford losing some of the photos.&lt;/p&gt;

&lt;p&gt;But some of these corrupted files are just partially corrupted eg. a video can be played ok in the first 50%&lt;/p&gt;

&lt;p&gt;There is still a way to copy the corrupted files.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man1/dd.1.html&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;dd&lt;/code&gt;&lt;/a&gt; let you copy bit by bit, even if an input error occurs:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;dd &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;myfile.MOV &lt;span class=&quot;nv&quot;&gt;of&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/Volumes/MyDrive/myfile.MOV &lt;span class=&quot;nv&quot;&gt;conv&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;noerror,sync
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;The above will copy “myfile.MOV” even if it is corrupted.&lt;/p&gt;

&lt;h2 id=&quot;check-your-disk-health-status&quot;&gt;Check your disk health status&lt;/h2&gt;

&lt;p&gt;Using &lt;a href=&quot;https://support.apple.com/kb/PH22243?locale=en_SG&quot;&gt;Disk Utility&lt;/a&gt;, run “First Aid” to repair. Sometimes you may need to boot into &lt;a href=&quot;/2017/04/06/guide-to-boot-up-macos-in-other-modes-and-troubleshooting/&quot;&gt;Recovery mode&lt;/a&gt; to run.&lt;/p&gt;

&lt;p&gt;Or run &lt;code class=&quot;highlighter-rouge&quot;&gt;/sbin/fsck -fy&lt;/code&gt; (might need to be in &lt;a href=&quot;/2017/04/06/guide-to-boot-up-macos-in-other-modes-and-troubleshooting/&quot;&gt;Single User mode&lt;/a&gt;), which does the same as First Aid.&lt;/p&gt;

&lt;h2 id=&quot;backing-up-frequently-is-important&quot;&gt;Backing up frequently is important&lt;/h2&gt;

&lt;p&gt;It is my fault for losing my dear photos, though I also blame my 5 year old iMac (2012 model) which seems to be failing. It is either the OS fault or the drive is having bad sectors.&lt;/p&gt;

&lt;p&gt;But it is user’s fault for not having a backup plan. I backup but only occassionally, and manually by copying to another external drive.&lt;/p&gt;

&lt;p&gt;I didn’t use Time Machine, because I didn’t have a hard disk that is big enough for my near 1 TB of data on iMac.&lt;/p&gt;

&lt;p&gt;I have since bought a &lt;a href=&quot;http://amzn.to/2tblyR0&quot;&gt;3 TB external drive&lt;/a&gt; at $102 USD. This should serve well as a Time Machine backup drive for the next few years.&lt;/p&gt;
</description>
        <pubDate>Mon, 26 Jun 2017 00:03:39 +0800</pubDate>
        <link>http://samwize.com/2017/06/26/backing-up-photo-library-and-handling-corrupted-files-error-36/</link>
        <guid isPermaLink="true">http://samwize.com/2017/06/26/backing-up-photo-library-and-handling-corrupted-files-error-36/</guid>
        
        
      </item>
    
      <item>
        <title>Tip: Debugging UI Calls in Background Threads</title>
        <description>&lt;p&gt;We all know UI calls have to be run in the main thread.&lt;/p&gt;

&lt;p&gt;But sometimes mistake happen, and you will see this in debug log:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;This application is modifying the autolayout engine from a background thread after the engine was accessed from the main thread. This can lead to engine corruption and weird crashes.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;There is a easy way to trace which part of your code is casuing the problem.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Add Symbolic Breakpoint&lt;/li&gt;
  &lt;li&gt;Symbol: &lt;code class=&quot;highlighter-rouge&quot;&gt;[UIView layoutIfNeeded]&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Condition: &lt;code class=&quot;highlighter-rouge&quot;&gt;!(BOOL)[NSThread isMainThread]&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;There are other “symbols” to catch. Create a symbolic breakpoint for &lt;strong&gt;each of these symbols&lt;/strong&gt;:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;[UIView updateConstraintsIfNeeded]&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;[UIView setNeedsUpdateConstraints]&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;[UIView setNeedsDisplay]&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;[UIView setNeedsLayout]&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Run the app, and Xcode will break at the offending code.&lt;/p&gt;

&lt;p&gt;Lastly, the fix as we all know:&lt;/p&gt;

&lt;div class=&quot;language-swift highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;DispatchQueue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// The UI call&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</description>
        <pubDate>Tue, 06 Jun 2017 09:52:50 +0800</pubDate>
        <link>http://samwize.com/2017/06/06/debugging-ui-calls-in-background-threads/</link>
        <guid isPermaLink="true">http://samwize.com/2017/06/06/debugging-ui-calls-in-background-threads/</guid>
        
        
        <category>iOS</category>
        
      </item>
    
      <item>
        <title>Xcode 8 File Templates</title>
        <description>&lt;h2 id=&quot;the-secret-feature-of-xcode&quot;&gt;The secret feature of Xcode&lt;/h2&gt;

&lt;p&gt;Ok, not exactly a secret, but it is definitely one of the less known features of Xcode, that was &lt;a href=&quot;https://developer.apple.com/search/?q=xcode%20template&quot;&gt;never documented&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Whenever you add a new file, you are using one of the provided &lt;strong&gt;File Templates&lt;/strong&gt;. Eg. When you choose a “Cocoa Touch Class” and subsequently selected a UIViewController subclass, it is simply generating the new file with a template.&lt;/p&gt;

&lt;p&gt;Knowing how to make full use of it will speed up your development, similar to the &lt;a href=&quot;/2014/03/26/tip-use-xcode-snippets/&quot;&gt;tip on Xcode’s code snippets&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;If you are using a certain architecture that needs to create many files for a module, file template can help to create and generate boilerplate codes quickly.&lt;/p&gt;

&lt;h2 id=&quot;creating-your-file-template&quot;&gt;Creating Your File Template&lt;/h2&gt;

&lt;p&gt;You have to store Xcode file templates in&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;~/Library/Developer/Xcode/Templates/File Templates/
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;This is stored under your user account. In the later section, we will share a tip using Dropbox to sync all your templates.&lt;/p&gt;

&lt;p&gt;For now, let’s create your template under that directory. The &lt;code class=&quot;highlighter-rouge&quot;&gt;/Templates/File Templates/&lt;/code&gt; folders have to be created along with your template eg. &lt;code class=&quot;highlighter-rouge&quot;&gt;MyTemplate.xctemplate&lt;/code&gt; (a directory with the extension .xctemplate)&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mkdir -p ~/Library/Developer/Xcode/Templates/File\ Templates/MyTemplate.xctemplate/
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;There is another kind of template known as &lt;strong&gt;Project Templates&lt;/strong&gt;. We will not be discussing it, but you should have guessed where it should be – &lt;code class=&quot;highlighter-rouge&quot;&gt;~/Library/Developer/Xcode/Templates/Project Templates/&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Now, let’s refer to the provided standard Xcode file templates, which are all in&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/Applications/Xcode.app/Contents/Developer/Library/Xcode/Templates/File Templates/
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;We will copy the simple swift template, and modify for our use later.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cp -R \
/Applications/Xcode.app/Contents/Developer/Library/Xcode/Templates/File\ Templates/Source/Swift\ File.xctemplate/ \
~/Library/Developer/Xcode/Templates/File\ Templates/MyTemplate.xctemplate/
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;You will see a few files in &lt;code class=&quot;highlighter-rouge&quot;&gt;~/Library/Developer/Xcode/Templates/File\ Templates/MyTemplate.xctemplate/&lt;/code&gt;.&lt;/p&gt;

&lt;h2 id=&quot;how-to-use-your-template&quot;&gt;How to use your template&lt;/h2&gt;

&lt;p&gt;At this point, your custom template can already be used.&lt;/p&gt;

&lt;p&gt;In Xcode, add a new file, and search for “MyTemplate” (or scroll to File Templates at the bottom), and it will generate an empty Swift file.&lt;/p&gt;

&lt;p&gt;You can also see your template under File Template Library. Or press &lt;code class=&quot;highlighter-rouge&quot;&gt;CMD + ALT + CTRL + 1&lt;/code&gt;. You might need to restart Xcode for it to find the newly created template. You can drag a template to your project navigation.&lt;/p&gt;

&lt;h2 id=&quot;customize-the-template&quot;&gt;Customize the template&lt;/h2&gt;

&lt;p&gt;Good, now let’s learn how to customize the template.&lt;/p&gt;

&lt;p&gt;There are a few files in a template.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;TemplateIcon.png&lt;/code&gt; (and the @2x) is obvious – a visual icon to represent your template in Xcode&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;TemplateInfo.plist&lt;/code&gt; – like project Info.plist, this property file describes the template&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The rest of the files (eg &lt;code class=&quot;highlighter-rouge&quot;&gt;___FILEBASENAME___.swift&lt;/code&gt;) are the actual files that will be created. If you add more files eg. &lt;code class=&quot;highlighter-rouge&quot;&gt;___FILEBASENAME___+Extension.swift&lt;/code&gt;, then that file will be created too.&lt;/p&gt;

&lt;p&gt;Let’s dive deeper into &lt;code class=&quot;highlighter-rouge&quot;&gt;TemplateInfo.plist&lt;/code&gt;, which provides many options.&lt;/p&gt;

&lt;p&gt;There are a few &lt;code class=&quot;highlighter-rouge&quot;&gt;Kind&lt;/code&gt; of templates. We usually use &lt;code class=&quot;highlighter-rouge&quot;&gt;Xcode.IDEFoundation.TextSubstitutionFileTemplateKind&lt;/code&gt;. Others are &lt;code class=&quot;highlighter-rouge&quot;&gt;Xcode.IDEKit.PlaygroundWithPlatformChoice&lt;/code&gt; etc.&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;Summary&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Description&lt;/code&gt; are obvious.&lt;/p&gt;

&lt;h3 id=&quot;options&quot;&gt;Options&lt;/h3&gt;

&lt;p&gt;You can provide many &lt;code class=&quot;highlighter-rouge&quot;&gt;Option&lt;/code&gt;s, an array of dictionary.&lt;/p&gt;

&lt;p&gt;Let’s look at this example, with 1 item in the &lt;code class=&quot;highlighter-rouge&quot;&gt;Option&lt;/code&gt; array.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/images/xcode-template-options.png&quot; alt=&quot;Example&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;Identifier&lt;/code&gt; is very important. It is the variable name that can be used in the file template.&lt;/p&gt;

&lt;p&gt;Eg In &lt;code class=&quot;highlighter-rouge&quot;&gt;___FILEBASENAME___.swift&lt;/code&gt;, you can have this:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;let ___VARIABLE_FOO___: String
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;When you create the file, you will be prompted to enter for “Foo:”, with a default text “ohMyFoo”. The actual generated then becomes&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;let ohMyFoo: String
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;You could have other &lt;code class=&quot;highlighter-rouge&quot;&gt;Type&lt;/code&gt;, such as &lt;code class=&quot;highlighter-rouge&quot;&gt;popup&lt;/code&gt; with it’s &lt;code class=&quot;highlighter-rouge&quot;&gt;Values&lt;/code&gt; array.&lt;/p&gt;

&lt;p&gt;As you can imagine, you can have multiple variables to be used in the file template.&lt;/p&gt;

&lt;h2 id=&quot;sync-to-dropbox&quot;&gt;Sync to Dropbox&lt;/h2&gt;

&lt;p&gt;If you are using multiple machine, you will like this tip.&lt;/p&gt;

&lt;p&gt;We can store our templates in Dropbox, and using symlink to the Xcode folders. This is similar to the tip for &lt;a href=&quot;/2014/03/26/tip-use-xcode-snippets/&quot;&gt;syncing code snippets&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://db.tt/GRqFn03&quot;&gt;Signup for Dropbox&lt;/a&gt; if you don’t have an account.&lt;/p&gt;

&lt;p&gt;I store them under &lt;code class=&quot;highlighter-rouge&quot;&gt;~/Dropbox/Workspace/Xcode/Templates&lt;/code&gt;. It’s up to you where to store. Move your custom templates to the folder.&lt;/p&gt;

&lt;p&gt;For our example, it will be in &lt;code class=&quot;highlighter-rouge&quot;&gt;~/Dropbox/Workspace/Xcode/Templates/File Templates/MyTemplate.xctemplate/&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Then create the symbolic link:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;ln -s ~/Dropbox/Workspace/Xcode/Templates ~/Library/Developer/Xcode/Templates/
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;That’s it! Remember to create the symbolic link for every machine.&lt;/p&gt;
</description>
        <pubDate>Fri, 12 May 2017 14:40:33 +0800</pubDate>
        <link>http://samwize.com/2017/05/12/xcode-8-file-templates/</link>
        <guid isPermaLink="true">http://samwize.com/2017/05/12/xcode-8-file-templates/</guid>
        
        
        <category>Xcode</category>
        
      </item>
    
  </channel>
</rss>
