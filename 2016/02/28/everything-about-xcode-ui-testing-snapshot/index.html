<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <link type="application/atom+xml" rel="alternate" href="https://samwize.com/feed.xml" title="@samwize" />

  <!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Everything About Xcode UI Testing | @samwize</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Everything About Xcode UI Testing" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A previous post on using fastlane’s snapshot for automating screenshots capture provided some good tips." />
<meta property="og:description" content="A previous post on using fastlane’s snapshot for automating screenshots capture provided some good tips." />
<link rel="canonical" href="https://samwize.com/2016/02/28/everything-about-xcode-ui-testing-snapshot/" />
<meta property="og:url" content="https://samwize.com/2016/02/28/everything-about-xcode-ui-testing-snapshot/" />
<meta property="og:site_name" content="@samwize" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-02-28T23:05:42+08:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@samwize" />
<meta name="twitter:creator" content="@samwize" />
<meta property="fb:admins" content="704185456" />
<script type="application/ld+json">
{"description":"A previous post on using fastlane’s snapshot for automating screenshots capture provided some good tips.","headline":"Everything About Xcode UI Testing","dateModified":"2016-02-28T23:05:42+08:00","datePublished":"2016-02-28T23:05:42+08:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://samwize.com/2016/02/28/everything-about-xcode-ui-testing-snapshot/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://samwize.com/"}},"url":"https://samwize.com/2016/02/28/everything-about-xcode-ui-testing-snapshot/","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <link rel="icon" type="image/png" href="https://just2us.com/img/favicon-180.png" />
  <link rel="apple-touch-icon" href="https://just2us.com/img/favicon-192.png"/>

  <link rel="stylesheet" href="//brick.a.ssl.fastly.net/Linux+Libertine:400,400i,700,700i/Open+Sans:400,400i,700,700i">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <link rel="stylesheet" type="text/css" media="screen" href="/css/main.css" />
  <link rel="stylesheet" type="text/css" media="print" href="/css/print.css" />

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-8504591086876220",
            enable_page_level_ads: true
       });
  </script>
</head>
  <link href='/stylesheets/all-5a7a81bc37ee3944f1d90d03edea2c57.css' media='all' rel='stylesheet' type='text/css'>
  <body itemscope itemtype="http://schema.org/Article">
    <!-- header start -->

<a href="https://samwize.com" class="logo-readium"><span class="logo" style="background-image: url(/assets/icons/home.png)"></span></a>

<!-- header end -->
    <main class="content" role="main">
      <article class="post">
        
        <div class="noarticleimage">
          <div class="post-meta">
            <h1 class="post-title">Everything About Xcode UI Testing</h1>
            <div class="cf post-meta-text">
              <time datetime="2016-02-28T23:05:42+08:00">28 February 2016</time>
            </div>
          </div>
        </div>
        <br>
        <br>
        <br>
        
        <section class="post-content">
          <div class="post-reading">
            <span class="post-reading-time"></span> read
          </div>
          <a name="topofpage"></a>
          
          <p>A previous post on using <a href="http://samwize.com/2015/12/09/automate-screenshots-capture-using-snapshot-via-xcode-ui-testing/">fastlane’s snapshot</a> for automating screenshots capture provided some good tips.</p>

<p>This post focus on Xcode UI Testing (not snapshot), and is more comprehensive, as it is a complex and not very well documented subject. Plus there are weird buggy behaviours when running UI automation.</p>

<h2 id="recording-interactions">Recording Interactions</h2>

<p>Xcode can generate code as you interact with your app. Start by creating a <strong>UI Testing target</strong>.</p>

<p>The record button is disabled at first, because you need to successfully run test once. To do that, go to <strong>Product &gt; Test</strong>. Also ensure your test cases are listed in your app target scheme under Test.</p>

<p>However, most likely you will not want to use the generated code, as the way they select element is immature, and always producing very long chained statements.</p>

<h2 id="use-accessibility-identifier">Use Accessibility Identifier</h2>

<p>The code generated by Xcode will try to refer to elements using <strong>Accessibility Identifier</strong>, such as:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s">"back"</span><span class="p">]</span><span class="o">.</span><span class="nf">tap</span><span class="p">()</span>
</code></pre></div></div>

<p>Note that <strong>“back”</strong> is an identifier, compared to <strong>“Back”</strong> the name/text in English.</p>

<p>You should NOT be using the accessibility name since that could be localized, so running in different languages would not work as expected. You should always be using accessibility identifier.</p>

<p>Pitfall: Some components such as <code class="highlighter-rouge">UIBarButtonItem</code> don’t have the accessibility identifier field under identifier inspector. You could still add it as user defined runtime attributes <code class="highlighter-rouge">accessibilityIdentifier</code> with type String.</p>

<h2 id="tool-accessibility-inspector">Tool: Accessibility Inspector</h2>

<p>You can open the tool from Xcode &gt; Open Developer Tool &gt; Accessibility Inspector</p>

<p>Run in the simulator, click on the button in top toolbar to start inspection.</p>

<h2 id="print-ui-hierarchy">Print UI Hierarchy</h2>

<p>Before we learnt how to select elements, it is useful to print out the UI hierarchy. You could write print statements with the element <code class="highlighter-rouge">debugDescription</code>.</p>

<p>Or you can set breakpoint, then evaluates with <code class="highlighter-rouge">po anElement</code>.</p>

<p>An example of a hierarchy:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Other 0x7ff0014a3bc0: traits: 8589934592, {{0.0, 0.0}, {414.0, 736.0}}
   Other 0x7ff00149a490: traits: 8589934592, {{0.0, 0.0}, {414.0, 736.0}}
     NavigationBar 0x7ff00146b8a0: traits: 35192962023424, {{0.0, 20.0}, {414.0, 44.0}}, identifier: 'home'
       Image 0x7ff00174bde0: traits: 8589934596, {{0.0, 0.0}, {414.0, 64.0}}
         Image 0x7ff0014984f0: traits: 8589934596, {{0.0, 64.0}, {414.0, 0.3}}
       Button 0x7ff0014a4240: traits: 8724152321, {{12.0, 31.7}, {21.0, 21.0}}, identifier: 'back'
</code></pre></div></div>

<p>You can easily see the views hierarchy, type, and identifier. This will come in very handy.</p>

<h2 id="selecting-row-in-table-view">Selecting row in table view</h2>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp"># To select row 0</span>
<span class="n">app</span><span class="o">.</span><span class="n">tables</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="nf">elementBoundByIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="nf">tap</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="selecting-childrendescendants">Selecting Children/Descendants</h2>

<p>Using <code class="highlighter-rouge">childrenMatchingType</code>, you can get elements that are direct children of an element. In the following, it gets all the children that is of type <code class="highlighter-rouge">Image</code>, and at index 2:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">anElement</span><span class="o">.</span><span class="nf">childrenMatchingType</span><span class="p">(</span><span class="o">.</span><span class="kt">Image</span><span class="p">)</span><span class="o">.</span><span class="nf">elementBoundByIndex</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="tests-if-element-exists">Tests if element exists</h2>

<p>You can write logical statements and do something, only if certain element exists.</p>

<p>To check if an element exists, simply use the <code class="highlighter-rouge">exists</code> property for a <code class="highlighter-rouge">XCUIElement</code>.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s">"back"</span><span class="p">]</span><span class="o">.</span><span class="n">exists</span> <span class="p">{</span>
  <span class="c1">// Then do something</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="wait-for-an-element-to-appear">Wait for an element to appear</h2>

<p>Sometimes, it takes a while for an element to appear (and be “existed”).</p>

<p>The following waits for 5 sec for the back button to appear.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">XCTAssert</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s">"back"</span><span class="p">]</span><span class="o">.</span><span class="nf">waitForExistence</span><span class="p">(</span><span class="nv">timeout</span><span class="p">:</span> <span class="mi">5</span><span class="p">))</span>
</code></pre></div></div>

<p><del>Or use a <a href="http://averagepro.com/tag/xctest/">helper</a>.</del></p>

<h2 id="force-tap">Force Tap</h2>

<p>For strange (aka bugs), certain devices running certain languages might not be able to tap on an element, even if it should be tappable.</p>

<blockquote>
  <p>Assertion Failure: UI Testing Failure - Unable to find hit point for Button</p>
</blockquote>

<p>The <a href="https://forums.developer.apple.com/thread/24131">solution</a> is to force tap. When an element is un-tappable, get it’s coordinate, and make a tap.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">XCUIElement</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">forceTap</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">self</span><span class="o">.</span><span class="n">hittable</span> <span class="p">{</span>
            <span class="k">self</span><span class="o">.</span><span class="nf">tap</span><span class="p">()</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">coordinate</span><span class="p">:</span> <span class="kt">XCUICoordinate</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="nf">coordinateWithNormalizedOffset</span><span class="p">(</span><span class="kt">CGVectorMake</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
            <span class="n">coordinate</span><span class="o">.</span><span class="nf">tap</span><span class="p">()</span>
        <span class="p">}</span>  
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>For example, if the error is thrown when a button is <code class="highlighter-rouge">tap()</code>, you can change to <code class="highlighter-rouge">forceTap()</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">app</span><span class="o">.</span><span class="n">buttons</span><span class="p">[</span><span class="s">"back"</span><span class="p">]</span><span class="o">.</span><span class="nf">forceTap</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="xcuicoordinate">XCUICoordinate</h2>

<p>We have used <code class="highlighter-rouge">XCUICoordinate</code> above. It is slightly more advanced way of dealing element by their coordinates.</p>

<p><code class="highlighter-rouge">XCUIElement.coordinateWithNormalizedOffset</code> creates a new coordinates, by multiplying with the normalized offset. That is, (0, 0) is the element bound origin, while (1,1) is the element bound bottom right. You can even create coordinates beyond the element rect with negative values, or more than 1.</p>

<p><code class="highlighter-rouge">XCUICoordinate.coordinateWithOffset</code> creates a new coordinates, by adding a offset. This time, it is using absolute points.</p>

<h2 id="sleep">Sleep</h2>

<p>The way to sleep is using <code class="highlighter-rouge">sleep(durationInSeconds)</code>. That simple.</p>

<h2 id="testing-ipad-vs-iphone">Testing iPad vs iPhone</h2>

<p>Most likely the UI for iPhone and iPad is different. To handle, you should have 2 test cases:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">testSnapshotPhone</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="kt">UIDevice</span><span class="o">.</span><span class="nf">currentDevice</span><span class="p">()</span><span class="o">.</span><span class="n">userInterfaceIdiom</span> <span class="o">==</span> <span class="o">.</span><span class="kt">Phone</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
    <span class="c1">// Capture screenshots for iPhone</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">testSnapshotPad</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="kt">UIDevice</span><span class="o">.</span><span class="nf">currentDevice</span><span class="p">()</span><span class="o">.</span><span class="n">userInterfaceIdiom</span> <span class="o">==</span> <span class="o">.</span><span class="kt">Pad</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
    <span class="c1">// Capture screenshots for iPad</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="launch-arguments--environment-variables">Launch Arguments &amp; Environment Variables</h2>

<p>You could have an app launch with special behaviours, by passing launch arguments or environnment variables.</p>

<p>These are 2 separate ways, but they are very similar. The key difference is that a launch argument is a string, and environnment variable is a key-value.</p>

<p>But when using launch argument, you can still use it as a key-value eg. <code class="highlighter-rouge">-SPECIAL_FEATURE YES</code>.</p>

<p>There are many <a href="http://nshipster.com/launch-arguments-and-environment-variables/">cool behaviours</a> you can enable, such as <code class="highlighter-rouge">-NSDoubleLocalizedStrings YES</code> to make all strings double it’s length, or <code class="highlighter-rouge">-AppleLanguages (fr)</code> to run in French.</p>

<p>This is how you launch your app with custom argument in <code class="highlighter-rouge">setUp</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">override</span> <span class="kd">func</span> <span class="nf">setUp</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">setUp</span><span class="p">()</span>
    <span class="n">app</span> <span class="o">=</span> <span class="kt">XCUIApplication</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">launchArguments</span> <span class="o">+=</span> <span class="p">[</span><span class="s">"-SPECIAL_FEATURE"</span><span class="p">,</span> <span class="s">"YES"</span><span class="p">]</span>
    <span class="n">app</span><span class="o">.</span><span class="nf">launch</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Then in your app, you can know if there is a launch argument with <code class="highlighter-rouge">NSUserDefaults</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">NSUserDefaults</span><span class="o">.</span><span class="nf">standardUserDefaults</span><span class="p">()</span><span class="o">.</span><span class="nf">boolForKey</span><span class="p">(</span><span class="s">"SPECIAL_FEATURE"</span><span class="p">)</span>
</code></pre></div></div>

<p>You may also use <code class="highlighter-rouge">NSProcessInfo.processInfo().arguments</code>. Using <code class="highlighter-rouge">NSUserDefaults</code> is more convenient since there is <code class="highlighter-rouge">boolForKey</code> and etc.</p>

<p>For environment variables, you will use <code class="highlighter-rouge">app.launchEnvironment</code> and <code class="highlighter-rouge">NSProcessInfo.processInfo().environment</code> correspondingly.</p>

<p>Note that <code class="highlighter-rouge">XCUIApplication</code> <a href="http://drekka.ghost.io/xcuiapplication-youre-probably-doing-it-wrong/">is not a singleton</a>! So don’t try to have multiple <code class="highlighter-rouge">XCUIApplication()</code> in your test case. Have 1 object variable <code class="highlighter-rouge">var app: XCUIApplication!</code> in your test case that is used in all methods.</p>

<h2 id="system-alerts">System Alerts</h2>

<p>If you have a <code class="highlighter-rouge">UIAlertController</code> showing up, or even a system dialog, you can interact with it using <a href="https://developer.apple.com/documentation/xctest/xctestcase/1496273-adduiinterruptionmonitorwithdesc"><code class="highlighter-rouge">addUIInterruptionMonitorWithDescription</code></a>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>addUIInterruptionMonitor(withDescription: "System permission prompt") { alert -&gt; Bool in
  alert.buttons["Allow"].tap()
  return true
}
</code></pre></div></div>

<h2 id="the-real-line-number">The Real Line Number</h2>

<p>When using <code class="highlighter-rouge">XCTAssert</code> method, it automatically print the line that it fails.</p>

<p>But if you wrap your own function around the <code class="highlighter-rouge">XCTAssert</code>, then it will print the line without giving helpful info. Say you have a <code class="highlighter-rouge">customAssert</code> that is being called in many places, then you can show the real line and file like this:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">func</span> <span class="nf">customAssert</span><span class="p">(</span><span class="n">_</span> <span class="nv">element</span><span class="p">:</span> <span class="kt">XCUIElement</span><span class="p">,</span> <span class="nv">file</span><span class="p">:</span> <span class="kt">StaticString</span> <span class="o">=</span> <span class="kd">#file</span><span class="p">,</span> <span class="nv">line</span><span class="p">:</span> <span class="kt">UInt</span> <span class="o">=</span> <span class="kd">#line</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">XCTAssert</span><span class="p">(</span><span class="n">someExpression</span><span class="p">,</span> <span class="nv">file</span><span class="p">:</span> <span class="n">file</span><span class="p">,</span> <span class="nv">line</span><span class="p">:</span> <span class="n">line</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>The default <code class="highlighter-rouge">#file</code> and <code class="highlighter-rouge">#line</code> will refer to the caller.</p>

<h2 id="pitfall-if-it-is-not-an-interactive-element">Pitfall: If it is not an interactive element..</h2>

<p>If you have elements that are NOT interactable with users, including containers, yet in UI tests you want to refer to it with identifier, read this.</p>

<p>You could set the accessibility identifier for such elements, but you should DISABLE the accessibility element.</p>

<p><img src="/images/disable-accessibility-element-but-with-identifier.png" alt="Disable Accessibility, but with identifier" /></p>

<p>Firstly, users will not be able to “access it” (in fact it confuses them if accessible). Secondly, using Accessibility Inspector will be cleaner. And very importantly, XCTest will not be screwed up with selection of element. Heed this advise!</p>

        </section>
        <footer class="post-footer">
          <section class="share">
            
              
            
              
            
          </section>
        </footer>
        <div class="bottom-teaser cf">
          <hr>
          <!-- Adsense-->
          <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
          <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-8504591086876220"
             data-ad-slot="5237367904"
             data-ad-format="auto"></ins>
          <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
        </div>
        
        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'just2us'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        
      </article>
    </main>
    <div class="bottom-closer">
      <div class="background-closer-image"  style="background-image: url(/assets/profile/cover-2015.jpg)">
        Image
      </div>
      <div class="inner">
        <h1 class="blog-title">@samwize</h1>
        <h2 class="blog-description">¯\_(ツ)_/¯
</h2>
        <a href="/" class="btn">Back to Home</a>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/assets/js/index.js"></script>
<script type="text/javascript" src="/assets/js/readingTime.min.js"></script>
<script>
(function ($) {
  "use strict";
  $(document).ready(function(){

    var $window = $(window),
    $image = $('.post-image-image, .teaserimage-image');
    
      $window.on('scroll', function() {
        var top = $window.scrollTop();

        if (top < 0 || top > 1500) { return; }
        $image
          .css('transform', 'translate3d(0px, '+top/3+'px, 0px)')
          .css('opacity', 1-Math.max(top/700, 0));
      });
      $window.trigger('scroll');

      var height = $('.article-image').height();
      $('.post-content').css('padding-top', height + 'px');

      $('a[href*=#]:not([href=#])').click(function() {
        if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'')
         && location.hostname == this.hostname) {
          var target = $(this.hash);
          target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
          if (target.length) {
            $('html,body').animate({ scrollTop: target.offset().top }, 500);
            return false;
          }
        }
      });

  });
}(jQuery));
</script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-8780506-5']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  </body>
</html>
